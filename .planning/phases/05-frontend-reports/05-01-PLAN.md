---
phase: 05-frontend-reports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/vite.config.ts
  - frontend/tsconfig.json
  - frontend/tsconfig.node.json
  - frontend/index.html
  - frontend/src/main.tsx
  - frontend/src/App.tsx
  - frontend/src/vite-env.d.ts
  - frontend/src/api/client.ts
  - frontend/src/stores/authStore.ts
  - frontend/src/types/user.ts
  - frontend/src/pages/Login.tsx
  - frontend/src/components/common/ProtectedRoute.tsx
  - frontend/.env
autonomous: true
must_haves:
  truths:
    - "User can navigate to /login and see login form"
    - "User can enter email and password to authenticate"
    - "Valid credentials redirect to dashboard"
    - "Invalid credentials show error message"
    - "Protected routes redirect unauthenticated users to login"
  artifacts:
    - path: "frontend/package.json"
      provides: "Dependencies: React, Vite, Ant Design, Zustand, Axios, React Router"
      contains: '"antd", "zustand", "axios", "react-router-dom"'
    - path: "frontend/src/api/client.ts"
      provides: "Axios instance with JWT interceptor and 401 handling"
      exports: ["api (default)"]
    - path: "frontend/src/stores/authStore.ts"
      provides: "Auth state with persist middleware"
      exports: ["useAuthStore"]
    - path: "frontend/src/pages/Login.tsx"
      provides: "Login form with email/password"
      min_lines: 50
  key_links:
    - from: "frontend/src/api/client.ts"
      to: "frontend/src/stores/authStore.ts"
      via: "import useAuthStore for 401 logout"
      pattern: "useAuthStore.getState\\(\\).logout"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/common/ProtectedRoute.tsx"
      via: "wrap protected routes"
      pattern: "ProtectedRoute"
---

<objective>
Build frontend foundation: Vite project setup, Ant Design configuration, Axios API client with JWT handling, Zustand auth store, and Login page.

Purpose: Establish the core infrastructure for the frontend application with authentication flow.
Output: Working login page that authenticates against backend API and stores JWT token.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-frontend-reports/05-RESEARCH.md

# Backend API available at http://localhost:8000
# POST /api/auth/login - accepts form-data: username=email, password
# GET /api/auth/me - returns current user info
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite + React + TypeScript + Ant Design project</name>
  <files>
    frontend/package.json
    frontend/vite.config.ts
    frontend/tsconfig.json
    frontend/tsconfig.node.json
    frontend/index.html
    frontend/src/main.tsx
    frontend/src/App.tsx
    frontend/src/vite-env.d.ts
    frontend/.env
  </files>
  <action>
Create frontend directory with Vite React TypeScript project.

1. Run: `npm create vite@latest frontend -- --template react-ts`
2. Install dependencies:
   - antd@5.x (NOT 6.x - stability)
   - @ant-design/icons
   - zustand@5.x
   - axios
   - react-router-dom@7.x
3. Configure vite.config.ts with:
   - Path alias `@` -> `src/`
   - Proxy `/api` to `http://localhost:8000` for dev
4. Create .env with `VITE_API_URL=http://localhost:8000`
5. In main.tsx, wrap App with:
   - `<ConfigProvider locale={ruRU}>` for Russian locale
6. App.tsx should have basic structure with BrowserRouter ready for routes

IMPORTANT: Use `npm install` not `yarn` or `pnpm` to match backend patterns.
</action>
  <verify>
    cd frontend && npm run build
    # Should compile without errors
  </verify>
  <done>
Frontend project created with all dependencies installed, Vite configured with @ alias and API proxy, Russian locale configured.
</done>
</task>

<task type="auto">
  <name>Task 2: Create API client with JWT interceptors</name>
  <files>
    frontend/src/api/client.ts
    frontend/src/types/user.ts
  </files>
  <action>
Create Axios API client with full JWT handling.

1. Create src/types/user.ts with User interface (id, email, is_active, is_admin, created_at)

2. Create src/api/client.ts:
   - Axios instance with baseURL from VITE_API_URL env
   - Request interceptor: adds `Authorization: Bearer ${token}` from authStore
   - Response interceptor:
     - On 401: call authStore.logout(), redirect to /login via window.location
     - On error: show message.error() with error.response?.data?.detail
   - Export `api` as default

3. Request interceptor MUST read token directly from store state (useAuthStore.getState().token) not via hook

CRITICAL: The 401 handler must use window.location.href = '/login' (not useNavigate) because interceptors run outside React context.
</action>
  <verify>
    cd frontend && npx tsc --noEmit
    # Should pass type checking
  </verify>
  <done>
API client with JWT interceptor and 401 auto-logout ready for use by auth store and API functions.
</done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand auth store with persist</name>
  <files>
    frontend/src/stores/authStore.ts
  </files>
  <action>
Create Zustand auth store with localStorage persistence.

Store interface:
- token: string | null
- user: User | null  
- isLoading: boolean
- login(email, password): Promise<void> - calls API, stores token, fetches user
- logout(): void - clears token and user
- fetchUser(): Promise<void> - GET /api/auth/me

Implementation:
1. Use `create` from zustand
2. Wrap with `persist` middleware
3. partialize: only persist `token` (not user, not isLoading)
4. storage: createJSONStorage(() => localStorage)
5. login() should call backend POST /api/auth/login with URLSearchParams body (username=email, password)
6. After successful login, fetch user info with GET /api/auth/me

IMPORTANT: Backend expects form-data for login (username=email), NOT JSON.
</action>
  <verify>
    cd frontend && npx tsc --noEmit
    # Check store exports correctly
    grep -q "useAuthStore" frontend/src/stores/authStore.ts
  </verify>
  <done>
Auth store with login/logout/fetchUser actions and token persistence in localStorage.
</done>
</task>

<task type="auto">
  <name>Task 4: Create Login page and ProtectedRoute</name>
  <files>
    frontend/src/pages/Login.tsx
    frontend/src/components/common/ProtectedRoute.tsx
    frontend/src/App.tsx
  </files>
  <action>
Create login page and route protection.

Login.tsx:
- Ant Design Form with email (Input) and password (Input.Password)
- Submit button with loading state from authStore.isLoading
- On submit: call authStore.login()
- On success: navigate to "/" using useNavigate
- Show error via message.error() on failure
- Card layout centered on screen

ProtectedRoute.tsx:
- Check useAuthStore((s) => s.token)
- If no token: <Navigate to="/login" state={{ from: location }} replace />
- If token exists: render children

App.tsx routes:
- /login -> Login (public)
- / -> Dashboard (protected) - placeholder div for now
- /movements -> Journal (protected) - placeholder div for now
- * -> Navigate to /

Wrap protected routes inside AppLayout placeholder (just a div with children for now).
</action>
  <verify>
    cd frontend && npm run build
    # Should compile without errors
  </verify>
  <done>
Login page functional, protected routes redirect to login when no token, authenticated users can access protected routes.
</done>
</task>

</tasks>

<verification>
1. Run `cd frontend && npm run dev` - should start on port 5173
2. Navigate to http://localhost:5173 - should redirect to /login
3. Enter invalid credentials - should show error message
4. Enter valid credentials (admin/admin123) - should redirect to dashboard placeholder
5. Refresh page - should stay authenticated (token persisted)
6. Clear localStorage - should redirect to /login
</verification>

<success_criteria>
- Vite project builds without errors
- Login page renders with email/password form
- Valid credentials authenticate and redirect to dashboard
- Invalid credentials show error message
- Token persisted in localStorage
- 401 responses trigger logout and redirect to login
- Russian locale active (Ant Design components show Russian text)
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-reports/05-01-SUMMARY.md`
</output>

---
phase: 05-frontend-reports
plan: 04
type: execute
wave: 4
depends_on:
  - "05-03"
files_modified:
  - frontend/src/pages/Movements/Journal.tsx
  - frontend/src/api/movements.ts
  - frontend/src/App.tsx
autonomous: true
must_haves:
  truths:
    - "User can navigate to Movements Journal page"
    - "User sees table of all movements with columns: date, type, product, quantity, source/DC"
    - "User can filter by operation type"
    - "User can filter by date range"
    - "User can filter by product (barcode search)"
    - "Operation types have color-coded tags (green/orange/blue/red)"
    - "Table has pagination with page size options"
  artifacts:
    - path: "frontend/src/pages/Movements/Journal.tsx"
      provides: "Movement journal with filters and color coding"
      min_lines: 180
    - path: "frontend/src/api/movements.ts"
      provides: "Get movements with filters API"
      exports: ["getMovements", "createMovement"]
  key_links:
    - from: "frontend/src/pages/Movements/Journal.tsx"
      to: "frontend/src/api/movements.ts"
      via: "getMovements with filter params"
      pattern: "getMovements\\("
    - from: "frontend/src/pages/Movements/Journal.tsx"
      to: "frontend/src/utils/colors.ts"
      via: "Tag color prop"
      pattern: "getMovementColor"
---

<objective>
Build Movement Journal page with filtering, pagination, and color-coded operation types.

Purpose: Provide managers with a searchable history of all stock movements.
Output: Journal page showing movements with filters and visual operation type coding.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-frontend-reports/05-RESEARCH.md

# Backend API: GET /api/stock/movements
# Query params: skip, limit, operation_type, product_id, date_from, date_to
# Returns: { items: Movement[], total, skip, limit }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add getMovements API function</name>
  <files>
    frontend/src/api/movements.ts
    frontend/src/types/movement.ts
  </files>
  <action>
Extend movements API with get function.

types/movement.ts additions:
- MovementsResponse: { items: MovementResponse[], total: number, skip: number, limit: number }
- MovementFilters interface for query params

api/movements.ts additions:
- getMovements(params): GET /api/stock/movements
- Params: skip, limit, operation_type?, product_id?, date_from?, date_to?
- Convert date objects to ISO strings for API
- Returns MovementsResponse

Handle null/undefined filters gracefully.
</action>
  <verify>
    cd frontend && npx tsc --noEmit
  </verify>
  <done>
getMovements function available for journal page.
</done>
</task>

<task type="auto">
  <name>Task 2: Create Journal page with filters and color coding</name>
  <files>
    frontend/src/pages/Movements/Journal.tsx
    frontend/src/App.tsx
  </files>
  <action>
Create full-featured movement journal.

Journal.tsx:
- State: movements, loading, pagination, filters

Filter section (top):
- Row with filters:
  1. Select for operation_type (with "Все типы" option)
  2. RangePicker for date range
  3. Input for product barcode search
  4. "Применить" button to apply filters
  5. "Сбросить" button to clear filters

Table:
- Columns:
  1. Дата (created_at) - formatted date/time
  2. Тип операции (operation_type) - Tag with color from getMovementColor()
  3. Товар - barcode + seller_sku from product relation
  4. Количество (quantity)
  5. Источник/РЦ - source?.name or distribution_center?.name
- Pagination: showSizeChanger, showTotal, defaultPageSize=20
- Loading state with Spin

Load data:
- On mount with default filters
- When filters change
- When page changes

Wire App.tsx:
- Route /movements -> Journal component
</action>
  <verify>
    cd frontend && npm run build
  </verify>
  <done>
Journal page with all filters, color-coded tags, and pagination working.
</done>
</task>

</tasks>

<verification>
1. Login and navigate to Journal via sidebar
2. Verify movements table loads with data
3. Verify operation types have colored tags (green/orange/blue/red)
4. Filter by operation type - table should update
5. Filter by date range - table should update
6. Search by product barcode - table should filter
7. Reset filters - should clear all filters
8. Test pagination - next/prev pages, change page size
</verification>

<success_criteria>
- Journal page accessible from sidebar navigation
- Table displays all movement columns correctly
- Operation type column shows color-coded tags
- Type filter works (dropdown selection)
- Date range filter works (RangePicker)
- Product filter works (barcode search)
- Reset button clears all filters
- Pagination controls functional
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-reports/05-04-SUMMARY.md`
</output>

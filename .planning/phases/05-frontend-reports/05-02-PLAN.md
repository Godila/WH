---
phase: 05-frontend-reports
plan: 02
type: execute
wave: 2
depends_on:
  - "05-01"
files_modified:
  - frontend/src/components/layout/AppLayout.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/pages/Dashboard.tsx
  - frontend/src/api/products.ts
  - frontend/src/api/stock.ts
  - frontend/src/types/product.ts
  - frontend/src/types/stock.ts
  - frontend/src/App.tsx
autonomous: true
must_haves:
  truths:
    - "User sees sidebar navigation with Dashboard and Movements links"
    - "User sees products table with columns: barcode, GTIN, seller_sku, brand, size, stock, defect"
    - "User can search products by barcode or seller_sku"
    - "User sees statistics cards: total products, total stock, total defect"
    - "Table pagination works (page size, page navigation)"
  artifacts:
    - path: "frontend/src/pages/Dashboard.tsx"
      provides: "Main dashboard with table, search, and statistics"
      min_lines: 150
    - path: "frontend/src/components/layout/AppLayout.tsx"
      provides: "Layout with sidebar navigation"
      exports: ["AppLayout (default)"]
    - path: "frontend/src/api/products.ts"
      provides: "Products API functions"
      exports: ["getProducts", "searchProducts"]
    - path: "frontend/src/api/stock.ts"
      provides: "Stock summary API"
      exports: ["getStockSummary"]
  key_links:
    - from: "frontend/src/pages/Dashboard.tsx"
      to: "frontend/src/api/products.ts"
      via: "getProducts on mount"
      pattern: "getProducts\\("
    - from: "frontend/src/pages/Dashboard.tsx"
      to: "frontend/src/api/stock.ts"
      via: "getStockSummary for stats"
      pattern: "getStockSummary\\("
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/layout/AppLayout.tsx"
      via: "wrap protected routes"
      pattern: "<AppLayout"
---

<objective>
Build Dashboard page with AppLayout, products table, search functionality, and statistics cards.

Purpose: Provide managers a central view of all products with their stock levels and quick search capability.
Output: Functional dashboard showing products in a table with statistics overview.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-frontend-reports/05-RESEARCH.md

# Backend APIs:
# GET /api/products/?skip=0&limit=20&barcode=xxx
# GET /api/stock/summary - returns { total_products, total_stock, total_defect }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API functions for products and stock</name>
  <files>
    frontend/src/types/product.ts
    frontend/src/types/stock.ts
    frontend/src/api/products.ts
    frontend/src/api/stock.ts
  </files>
  <action>
Create TypeScript types and API functions.

types/product.ts:
- Product interface: id, barcode, gtin, seller_sku, size, brand, color, is_active, created_at
- ProductWithStock: extends Product with stock (number) and defect_stock (number)

types/stock.ts:
- StockSummary interface: total_products, total_stock, total_defect

api/products.ts:
- getProducts(skip=0, limit=20, barcode?): GET /api/products/ with query params
- Returns { items: ProductWithStock[], total: number, skip, limit }
- searchProducts(query): calls getProducts with barcode param

api/stock.ts:
- getStockSummary(): GET /api/stock/summary
- Returns StockSummary

All functions use the `api` client from @/api/client.
</action>
  <verify>
    cd frontend && npx tsc --noEmit
  </verify>
  <done>
Type definitions and API functions for products and stock ready for use in components.
</done>
</task>

<task type="auto">
  <name>Task 2: Create AppLayout with sidebar navigation</name>
  <files>
    frontend/src/components/layout/AppLayout.tsx
    frontend/src/components/layout/Header.tsx
  </files>
  <action>
Create layout with Ant Design Layout components.

AppLayout.tsx:
- Use Layout from antd with Sider + Layout
- Sider: collapsible, width=200, theme="light"
- Menu items:
  - Dashboard (icon: DashboardOutlined, path: /)
  - Журнал движений (icon: UnorderedListOutlined, path: /movements)
- Content area with padding, white background
- Use useNavigate for menu navigation
- selectedKeys from useLocation().pathname

Header.tsx:
- Show user email from authStore
- Logout button that calls authStore.logout() and navigates to /login
- Right-aligned user info

Use Outlet from react-router-dom to render child routes.
</action>
  <verify>
    cd frontend && npx tsc --noEmit
  </verify>
  <done>
AppLayout with working sidebar navigation and Header with logout functionality.
</done>
</task>

<task type="auto">
  <name>Task 3: Create Dashboard with table, search, and statistics</name>
  <files>
    frontend/src/pages/Dashboard.tsx
    frontend/src/App.tsx
  </files>
  <action>
Create Dashboard page with all features.

Statistics section (top):
- Row with 3 Cards, each containing Statistic:
  1. "Всего товаров" - total_products
  2. "Общий остаток" - total_stock
  3. "Всего брак" - total_defect
- Load from getStockSummary() on mount
- Show Spin while loading

Search bar:
- Input.Search with placeholder "Поиск по баркоду или артикулу"
- onSearch triggers product search with debounce (300ms)
- Enter triggers search

Products table:
- Columns: barcode, gtin, seller_sku, brand, size, stock (остаток), defect_stock (брак)
- Use Ant Design Table with pagination
- Load on mount, reload on search
- Show loading state
- Pagination: defaultPageSize=20, showSizeChanger, showTotal

App.tsx update:
- Import and use AppLayout to wrap protected routes
- Replace placeholder divs with actual route components

State management: Use useState for products, loading, pagination. Use useEffect for initial load.
</action>
  <verify>
    cd frontend && npm run build
  </verify>
  <done>
Dashboard shows statistics cards, searchable products table with pagination, all wired to backend API.
</done>
</task>

</tasks>

<verification>
1. Login to application
2. Verify sidebar shows Dashboard and Журнал движений links
3. Verify statistics cards show correct numbers from backend
4. Type in search box - table should filter by barcode/SKU
5. Verify pagination works (next page, change page size)
6. Click logout - should redirect to login
</verification>

<success_criteria>
- Sidebar navigation functional with correct active state
- Statistics show total_products, total_stock, total_defect from API
- Products table displays all columns correctly
- Search by barcode filters products in real-time
- Pagination controls work (page change, page size change)
- Header shows user email with working logout
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-reports/05-02-SUMMARY.md`
</output>
